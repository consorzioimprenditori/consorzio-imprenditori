<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consorzio Imprenditori - Sistema Completo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .app-container {
            width: 95%;
            max-width: 1400px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            min-height: 90vh;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .logo {
            width: 80px;
            height: 80px;
            background: white;
            border-radius: 15px;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #2c3e50;
            font-size: 40px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .user-info {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255,255,255,0.2);
            padding: 8px 12px;
            border-radius: 15px;
            font-size: 12px;
        }

        .nav-input {
            display: none;
        }

        .page {
            display: none;
        }

        #login:checked ~ .pages #loginPage,
        #admin-dashboard:checked ~ .pages #adminDashboardPage,
        #member-dashboard:checked ~ .pages #memberDashboardPage,
        #consulente-dashboard:checked ~ .pages #consulenteDashboardPage,
        #bacheca:checked ~ .pages #bachecaPage {
            display: block;
        }

        .nav-btn {
            background: linear-gradient(135deg, #555, #666);
            color: white;
            padding: 25px 15px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            text-decoration: none;
            display: block;
        }

        .nav-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
        }

        .nav-btn.admin {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .nav-btn.member {
            background: linear-gradient(135deg, #27ae60, #229954);
        }

        .nav-btn.consulente {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }

        .notification-dot {
            position: absolute;
            top: 10px;
            right: 10px;
            min-width: 18px;
            height: 18px;
            background: #e74c3c;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 11px;
            font-weight: bold;
            border: 2px solid white;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .card-icon {
            font-size: 24px;
            margin-bottom: 10px;
            display: block;
        }

        .card-title {
            font-size: 14px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        .btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .action-btn {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
        }

        .action-btn.blue {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }

        .action-btn.red {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .action-btn.purple {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }

        .action-btn.orange {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }

        .main-content {
            padding: 25px;
        }

        .page-content {
            padding: 25px;
        }

        .notification-item {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .stats-box {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }

        .admin-stats-box {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }

        .member-stats-box {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }

        .consulente-stats-box {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }

        .login-container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }

        .login-tabs {
            display: flex;
            margin-bottom: 20px;
            border-radius: 10px;
            overflow: hidden;
        }

        .login-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .login-tab.admin {
            background: #e74c3c;
            color: white;
        }

        .login-tab.member {
            background: #27ae60;
            color: white;
        }

        .login-tab.consulente {
            background: #9b59b6;
            color: white;
        }

        .login-tab.active {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .login-form {
            display: none;
        }

        .login-form.active {
            display: block;
        }

        .sezione-bacheca {
            display: none;
            min-height: 400px;
        }

        .sezione-bacheca.active {
            display: block !important;
        }

        .filter-bar {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-btn {
            padding: 8px 15px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 13px;
        }

        .filter-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }

        .badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
            margin-right: 5px;
        }

        .badge.green {
            background: #27ae60;
            color: white;
        }

        .badge.blue {
            background: #3498db;
            color: white;
        }

        .badge.purple {
            background: #9b59b6;
            color: white;
        }

        .badge.orange {
            background: #f39c12;
            color: white;
        }

        .badge.red {
            background: #e74c3c;
            color: white;
        }

        .tab-navigation {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 10px;
        }

        .tab-btn {
            padding: 10px 20px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-weight: bold;
            color: #7f8c8d;
            transition: all 0.3s;
            position: relative;
        }

        .tab-btn.active {
            color: #3498db;
        }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -12px;
            left: 0;
            right: 0;
            height: 3px;
            background: #3498db;
        }

        .annuncio-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #ecf0f1;
            transition: all 0.3s;
        }

        .annuncio-card:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .form-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .back-btn {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
        }

        .annuncio-foto {
            width: 100px;
            height: 80px;
            border-radius: 10px;
            object-fit: cover;
            border: 2px solid #ecf0f1;
        }

        .annuncio-foto-container {
            position: relative;
            width: 100px;
            height: 80px;
        }

        .remove-foto-btn {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5;
        }

        .foto-upload-container {
            border: 3px dashed #3498db;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            margin: 20px 0;
            background: linear-gradient(135deg, #f8f9ff, #e8f4fd);
            position: relative;
        }

        .foto-upload-container label {
            display: block;
            font-size: 16px;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 15px;
            cursor: pointer;
        }

        .foto-upload-container input[type="file"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #3498db;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            font-size: 14px;
        }

        .foto-upload-container::before {
            content: "📸";
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
        }

        .back-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateX(-3px);
        }

        @media (max-width: 768px) {
            .annuncio-foto {
                width: 80px;
                height: 64px;
            }
            
            .annuncio-foto-container {
                width: 80px;
                height: 64px;
            }
            
            .foto-preview {
                max-width: 150px;
                max-height: 120px;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Navigation Inputs -->
        <input type="radio" name="nav" id="login" class="nav-input" checked>
        <input type="radio" name="nav" id="admin-dashboard" class="nav-input">
        <input type="radio" name="nav" id="member-dashboard" class="nav-input">
        <input type="radio" name="nav" id="consulente-dashboard" class="nav-input">
        <input type="radio" name="nav" id="bacheca" class="nav-input">

        <div class="pages">
            <!-- Login Page -->
            <div id="loginPage" class="page">
                <div class="header">
                    <div class="logo">🏢</div>
                    <h1>Consorzio Imprenditori</h1>
                    <p>Riuniamo imprenditori allo scopo di collaborare e crescere insieme</p>
                </div>
                
                <div class="login-container">
                    <h2 style="text-align: center; margin-bottom: 25px; color: #2c3e50;">Accedi al Consorzio</h2>
                    
                    <div class="login-tabs">
                        <div class="login-tab admin" onclick="switchLoginTab('admin')">
                            🔐 ADMIN
                        </div>
                        <div class="login-tab member" onclick="switchLoginTab('member')">
                            👥 MEMBRI
                        </div>
                        <div class="login-tab consulente" onclick="switchLoginTab('consulente')">
                            💼 CONSULENTI
                        </div>
                    </div>

                    <!-- Admin Login Form -->
                    <div id="adminForm" class="login-form">
                        <div class="form-group">
                            <label>Email Amministratore</label>
                            <input type="email" id="adminEmail" value="admin@consorzio.it">
                        </div>
                        
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="adminPassword" value="admin123">
                        </div>
                        
                        <button class="btn" onclick="login('admin')" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">🔑 ACCESSO AMMINISTRATORE</button>
                    </div>

                    <!-- Member Login Form -->
                    <div id="memberForm" class="login-form">
                        <div class="form-group">
                            <label>Email Membro</label>
                            <input type="email" id="memberEmail" value="rossi@rossisrl.it">
                        </div>
                        
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="memberPassword" value="member123">
                        </div>
                        
                        <button class="btn" onclick="login('member')" style="background: linear-gradient(135deg, #27ae60, #229954);">🔑 ACCESSO MEMBRO</button>
                    </div>

                    <!-- Consulente Login Form -->
                    <div id="consulenteForm" class="login-form">
                        <div class="form-group">
                            <label>Email Consulente</label>
                            <input type="email" id="consulenteEmail" value="maria.bianchi@consorzio.it">
                        </div>
                        
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="consulentePassword" value="cons123">
                        </div>
                        
                        <button class="btn" onclick="login('consulente')" style="background: linear-gradient(135deg, #9b59b6, #8e44ad);">🔑 ACCESSO CONSULENTE</button>
                    </div>
                </div>
            </div>

            <!-- Admin Dashboard Page -->
            <div id="adminDashboardPage" class="page">
                <div class="header">
                    <button onclick="logout()" class="back-btn">🔙 Logout</button>
                    <div class="user-info">👤 Amministratore</div>
                    <div class="logo">🔐</div>
                    <h1>Dashboard Amministratori</h1>
                    <p>Pannello di controllo completo del Consorzio</p>
                </div>

                <div class="main-content">
                    <div class="admin-stats-box">
                        <h2 style="margin-bottom: 10px;">🔐 Controllo Totale Consorzio</h2>
                        <div style="display: flex; justify-content: center; gap: 25px; margin-top: 10px; flex-wrap: wrap;">
                            <div><div style="font-size: 20px; font-weight: bold;">15</div><div style="font-size: 11px;">Membri Attivi</div></div>
                            <div><div style="font-size: 20px; font-weight: bold;">20</div><div style="font-size: 11px;">Consulenti</div></div>
                            <div><div style="font-size: 20px; font-weight: bold;">48</div><div style="font-size: 11px;">Annunci Bacheca</div></div>
                            <div><div style="font-size: 20px; font-weight: bold;">8</div><div style="font-size: 11px;">Eventi Mese</div></div>
                        </div>
                    </div>
                    
                    <div class="dashboard-grid">
                        <label for="bacheca" class="nav-btn admin" onclick="entraNellaBacheca()">
                            <div class="notification-dot">48</div>
                            <div class="card-icon">📌</div>
                            <div class="card-title">BACHECA MARKETPLACE</div>
                        </label>

                        <div class="nav-btn admin" onclick="showNotification('👥 Gestione Membri - Funzione Attiva!', 'success')">
                            <div class="notification-dot">15</div>
                            <div class="card-icon">👥</div>
                            <div class="card-title">GESTIONE MEMBRI</div>
                        </div>

                        <div class="nav-btn admin" onclick="showNotification('💼 Gestione Consulenti - Funzione Attiva!', 'success')">
                            <div class="notification-dot">20</div>
                            <div class="card-icon">💼</div>
                            <div class="card-title">GESTIONE CONSULENTI</div>
                        </div>

                        <div class="nav-btn admin" onclick="showNotification('📅 Gestione Agenda - Funzione Attiva!', 'success')">
                            <div class="notification-dot">5</div>
                            <div class="card-icon">📅</div>
                            <div class="card-title">GESTIONE AGENDA</div>
                        </div>

                        <div class="nav-btn admin" onclick="showNotification('📋 Consulenze - Funzione Attiva!', 'success')">
                            <div class="notification-dot">12</div>
                            <div class="card-icon">📋</div>
                            <div class="card-title">CONSULENZE</div>
                        </div>

                        <div class="nav-btn admin" onclick="showNotification('🤝 Convenzioni - Funzione Attiva!', 'success')">
                            <div class="notification-dot">8</div>
                            <div class="card-icon">🤝</div>
                            <div class="card-title">CONVENZIONI</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Member Dashboard Page -->
            <div id="memberDashboardPage" class="page">
                <div class="header">
                    <button onclick="logout()" class="back-btn">🔙 Esci</button>
                    <div class="user-info">👤 Membro</div>
                    <div class="logo">👥</div>
                    <h1>Dashboard Membri</h1>
                    <p>Benvenuto nella piattaforma riservata ai membri</p>
                </div>

                <div class="main-content">
                    <div class="member-stats-box">
                        <h2 style="margin-bottom: 10px;">👥 Area Riservata Membri</h2>
                        <div style="display: flex; justify-content: center; gap: 25px; margin-top: 10px; flex-wrap: wrap;">
                            <div><div style="font-size: 20px; font-weight: bold;">20</div><div style="font-size: 11px;">Consulenti</div></div>
                            <div><div style="font-size: 20px; font-weight: bold;">48</div><div style="font-size: 11px;">Annunci</div></div>
                            <div><div style="font-size: 20px; font-weight: bold;">10</div><div style="font-size: 11px;">Consulenze Incluse</div></div>
                            <div><div style="font-size: 20px; font-weight: bold;">5</div><div style="font-size: 11px;">Eventi Mese</div></div>
                        </div>
                    </div>
                    
                    <div class="dashboard-grid">
                        <label for="bacheca" class="nav-btn member" onclick="entraNellaBacheca()">
                            <div class="notification-dot">48</div>
                            <div class="card-icon">📌</div>
                            <div class="card-title">BACHECA MARKETPLACE</div>
                        </label>

                        <div class="nav-btn member" onclick="showNotification('📅 Agenda Eventi - Funzione Attiva!', 'success')">
                            <div class="notification-dot">5</div>
                            <div class="card-icon">📅</div>
                            <div class="card-title">AGENDA EVENTI</div>
                        </div>

                        <div class="nav-btn member" onclick="showNotification('💼 20 Consulenti Disponibili!', 'success')">
                            <div class="notification-dot">20</div>
                            <div class="card-icon">💼</div>
                            <div class="card-title">CONSULENTI</div>
                        </div>

                        <div class="nav-btn member" onclick="showNotification('📋 Albo Membri - Funzione Attiva!', 'success')">
                            <div class="notification-dot">15</div>
                            <div class="card-icon">📋</div>
                            <div class="card-title">ALBO MEMBRI</div>
                        </div>

                        <div class="nav-btn member" onclick="showNotification('📹 Video - Funzione Attiva!', 'success')">
                            <div class="notification-dot">12</div>
                            <div class="card-icon">📹</div>
                            <div class="card-title">VIDEO</div>
                        </div>

                        <div class="nav-btn member" onclick="showNotification('🤝 Convenzioni - Funzione Attiva!', 'success')">
                            <div class="notification-dot">8</div>
                            <div class="card-icon">🤝</div>
                            <div class="card-title">CONVENZIONI</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Consulente Dashboard Page -->
            <div id="consulenteDashboardPage" class="page">
                <div class="header">
                    <button onclick="logout()" class="back-btn">🔙 Esci</button>
                    <div class="user-info">👤 Consulente</div>
                    <div class="logo">💼</div>
                    <h1>Dashboard Consulenti</h1>
                    <p>Gestisci le tue consulenze e appuntamenti</p>
                </div>

                <div class="main-content">
                    <div class="consulente-stats-box">
                        <h2 style="margin-bottom: 10px;">💼 Area Riservata Consulenti</h2>
                        <div style="display: flex; justify-content: center; gap: 25px; margin-top: 10px; flex-wrap: wrap;">
                            <div><div style="font-size: 20px; font-weight: bold;">3</div><div style="font-size: 11px;">Richieste Pending</div></div>
                            <div><div style="font-size: 20px; font-weight: bold;">8</div><div style="font-size: 11px;">Confermate</div></div>
                            <div><div style="font-size: 20px; font-weight: bold;">15</div><div style="font-size: 11px;">Membri Attivi</div></div>
                        </div>
                    </div>
                    
                    <div class="dashboard-grid">
                        <label for="bacheca" class="nav-btn consulente" onclick="entraNellaBacheca()">
                            <div class="notification-dot">48</div>
                            <div class="card-icon">📌</div>
                            <div class="card-title">BACHECA</div>
                        </label>

                        <div class="nav-btn consulente" onclick="showNotification('📋 Le Mie Consulenze - Funzione Attiva!', 'success')">
                            <div class="notification-dot">3</div>
                            <div class="card-icon">📋</div>
                            <div class="card-title">LE MIE CONSULENZE</div>
                        </div>

                        <div class="nav-btn consulente" onclick="showNotification('👥 Membri Consorzio - Funzione Attiva!', 'success')">
                            <div class="notification-dot">15</div>
                            <div class="card-icon">👥</div>
                            <div class="card-title">MEMBRI CONSORZIO</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bacheca Page COMPLETA -->
            <div id="bachecaPage" class="page">
                <div class="header">
                    <button onclick="tornaAlDashboard()" class="back-btn">← Dashboard</button>
                    <div class="user-info">👤 User</div>
                    <div class="logo">📌</div>
                    <h1>Bacheca del Consorzio</h1>
                </div>
                <div class="page-content">
                    <div class="stats-box">
                        <h2 style="margin-bottom: 10px;">📌 Marketplace & Collaborazioni</h2>
                        <div style="display: flex; justify-content: center; gap: 25px; margin-top: 10px; flex-wrap: wrap;">
                            <div><div style="font-size: 20px; font-weight: bold;" id="countVendita">1</div><div style="font-size: 11px;">Vendo/Compro</div></div>
                            <div><div style="font-size: 20px; font-weight: bold;" id="countPersonale">1</div><div style="font-size: 11px;">Ricerche Personale</div></div>
                            <div><div style="font-size: 20px; font-weight: bold;" id="countSpazi">1</div><div style="font-size: 11px;">Spazi</div></div>
                            <div><div style="font-size: 20px; font-weight: bold;" id="countCollab">1</div><div style="font-size: 11px;">Collaborazioni</div></div>
                        </div>
                        <!-- BOTTONE TEST PER DEBUG -->
                        <div style="margin-top: 15px; text-align: center;">
                            <button class="action-btn blue" onclick="window.updateDeleteButtons()" style="padding: 12px 20px; font-size: 14px; margin: 0 10px;">
                                🔄 Aggiorna Pulsanti
                            </button>
                            <button class="action-btn green" onclick="testFotoFunctions()" style="padding: 12px 20px; font-size: 14px; margin: 0 10px;">
                                📸 TEST FOTO SYSTEM
                            </button>
                            <button class="action-btn orange" onclick="aggiungiCampoFotoATutti()" style="padding: 12px 20px; font-size: 14px; margin: 0 10px;">
                                🎯 FORZA PULSANTI FOTO
                            </button>
                        </div>
                    </div>
                    
                    <!-- Tab Navigation -->
                    <div class="tab-navigation">
                        <button class="tab-btn active" onclick="switchTab('vendoCompro', this)">🛒 Vendo/Compro</button>
                        <button class="tab-btn" onclick="switchTab('ricercaPersonale', this)">👔 Personale</button>
                        <button class="tab-btn" onclick="switchTab('spaziCondivisi', this)">🏢 Spazi</button>
                        <button class="tab-btn" onclick="switchTab('collaborazioni', this)">🤝 Collaborazioni</button>
                    </div>

                    <!-- SEZIONE VENDO/COMPRO -->
                    <div id="sezioneVendoCompro" class="sezione-bacheca active">
                        <div class="filter-bar">
                            <button class="filter-btn active" onclick="filterAnnunci('tutti', this)">Tutti</button>
                            <button class="filter-btn" onclick="filterAnnunci('vendo', this)">🛒 Vendo</button>
                            <button class="filter-btn" onclick="filterAnnunci('compro', this)">💰 Compro</button>
                            <button class="action-btn" onclick="toggleForm('formVendoCompro')">➕ Nuovo Annuncio</button>
                        </div>

                        <!-- Container annunci Vendo/Compro -->
                        <div id="annunciVenditaContainer">
                            <div class="annuncio-card" id="annuncio_esempio_1" data-autore="rossi@rossisrl.it">
                                <div style="display: flex; gap: 15px; align-items: center;">
                                    <div style="width: 100px; height: 80px; background: linear-gradient(135deg, #27ae60, #229954); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 30px;">🔧</div>
                                    <div style="flex: 1;">
                                        <div style="margin-bottom: 8px;">
                                            <span class="badge green">VENDO</span>
                                            <span class="badge blue">ATTREZZATURE</span>
                                        </div>
                                        <h4 style="color: #2c3e50; margin-bottom: 5px;">Stampante HP LaserJet Pro</h4>
                                        <p style="color: #6c757d; font-size: 13px; margin-bottom: 8px;">Stampante professionale in ottime condizioni</p>
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <span style="color: #27ae60; font-weight: bold; font-size: 20px;">€1.200</span>
                                            <span style="color: #95a5a6; font-size: 11px;">Marco Rossi - 2 ore fa</span>
                                        </div>
                                    </div>
                                    <div style="display: flex; flex-direction: column; gap: 5px;" class="delete-btn-container">
                                        <!-- PULSANTI STATICI PER TEST -->
                                        <button class="action-btn green" style="padding: 6px 12px; font-size: 11px;" onclick="aggiungiFotoAnnuncio('annuncio_esempio_1')" title="Aggiungi foto">📸➕ Foto</button>
                                        <button class="action-btn red" style="padding: 8px 15px; font-size: 12px;" onclick="window.cancellaAnnuncio('annuncio_esempio_1', 'vendita')">🗑️ Cancella</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Form Vendo/Compro -->
                        <div id="formVendoCompro" class="form-section" style="display: none;">
                            <h3 style="color: #2c3e50; margin-bottom: 20px;">🛒 Pubblica Nuovo Annuncio</h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div class="form-group">
                                    <label>Tipo Annuncio</label>
                                    <select id="tipoAnnuncioVendita">
                                        <option value="VENDO">🛒 VENDO</option>
                                        <option value="COMPRO">💰 COMPRO</option>
                                        <option value="SCAMBIO">🔄 SCAMBIO</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Categoria</label>
                                    <select id="categoriaVendita">
                                        <option value="ATTREZZATURE">🔧 Attrezzature</option>
                                        <option value="MOBILI">🪑 Mobili</option>
                                        <option value="TECNOLOGIA">💻 Tecnologia</option>
                                        <option value="VEICOLI">🚗 Veicoli</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Titolo</label>
                                <input type="text" id="titoloVendita" placeholder="Es: Stampante HP LaserJet">
                            </div>
                            <div class="form-group">
                                <label>Descrizione</label>
                                <textarea id="descrizioneVendita" placeholder="Descrivi l'articolo..." style="min-height: 80px;"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Prezzo/Budget (€)</label>
                                <input type="text" id="prezzoVendita" placeholder="1200 o 'Scambio alla pari'">
                            </div>
                            <div class="foto-upload-container">
                                <label for="fotoVendita">📸 AGGIUNGI FOTO AL TUO ANNUNCIO</label>
                                <input type="file" id="fotoVendita" accept="image/*" onchange="previewFoto(this, 'previewVendita')">
                                <div id="previewVendita"></div>
                                <p style="font-size: 12px; color: #666; margin-top: 10px;">Formati supportati: JPG, PNG, GIF - Max 5MB</p>
                            </div>
                            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                                <button class="action-btn green" onclick="pubblicaAnnuncioVendita()">✅ Pubblica</button>
                                <button class="action-btn red" onclick="toggleForm('formVendoCompro')">❌ Annulla</button>
                            </div>
                        </div>
                    </div>

                    <!-- SEZIONE RICERCA PERSONALE -->
                    <div id="sezioneRicercaPersonale" class="sezione-bacheca">
                        <div class="filter-bar">
                            <button class="filter-btn active" onclick="filterPersonale('tutti', this)">Tutti</button>
                            <button class="filter-btn" onclick="filterPersonale('offro', this)">💼 Offro Lavoro</button>
                            <button class="filter-btn" onclick="filterPersonale('cerco', this)">🔍 Cerco Lavoro</button>
                            <button class="action-btn blue" onclick="toggleForm('formPersonale')">➕ Pubblica Offerta</button>
                            <button class="action-btn orange" onclick="window.updateDeleteButtons()" style="padding: 8px 15px; font-size: 12px;">
                                🔄 Aggiorna Pulsanti PERSONALE
                            </button>
                        </div>

                        <!-- Container annunci Personale -->
                        <div id="annunciPersonaleContainer">
                            <div class="annuncio-card" id="annuncio_esempio_2" data-autore="rossi@rossisrl.it">
                                <div style="display: flex; gap: 15px; align-items: center;">
                                    <div style="width: 100px; height: 80px; background: linear-gradient(135deg, #3498db, #2980b9); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 30px;">👨‍💻</div>
                                    <div style="flex: 1;">
                                        <div style="margin-bottom: 8px;">
                                            <span class="badge blue">OFFRO LAVORO</span>
                                            <span class="badge green">FULL-TIME</span>
                                        </div>
                                        <h4 style="color: #2c3e50; margin-bottom: 5px;">Sviluppatore Full Stack</h4>
                                        <p style="color: #6c757d; font-size: 13px; margin-bottom: 8px;">Cerchiamo developer con esperienza React/Node</p>
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <span style="color: #3498db; font-weight: bold;">€45-55K/anno</span>
                                            <span style="color: #95a5a6; font-size: 11px;">Marco Rossi - Oggi</span>
                                        </div>
                                    </div>
                                    <div style="display: flex; flex-direction: column; gap: 5px;" class="delete-btn-container">
                                        <!-- PULSANTI STATICI PER TEST -->
                                        <button class="action-btn green" style="padding: 6px 12px; font-size: 11px;" onclick="aggiungiFotoAnnuncio('annuncio_esempio_2')" title="Aggiungi foto">📸➕ Foto</button>
                                        <button class="action-btn red" style="padding: 8px 15px; font-size: 12px;" onclick="window.cancellaAnnuncio('annuncio_esempio_2', 'personale')">🗑️ Cancella</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Form Personale -->
                        <div id="formPersonale" class="form-section" style="display: none;">
                            <h3 style="color: #3498db; margin-bottom: 20px;">👔 Pubblica Offerta/Ricerca Lavoro</h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div class="form-group">
                                    <label>Tipo</label>
                                    <select id="tipoPersonale">
                                        <option value="OFFRO LAVORO">💼 Offro Lavoro</option>
                                        <option value="CERCO LAVORO">🔍 Cerco Lavoro</option>
                                        <option value="STAGE">🎓 Stage/Tirocinio</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Contratto</label>
                                    <select id="contrattoPersonale">
                                        <option value="FULL-TIME">Full-time</option>
                                        <option value="PART-TIME">Part-time</option>
                                        <option value="FREELANCE">Freelance</option>
                                        <option value="STAGE">Stage</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Posizione</label>
                                <input type="text" id="posizionePersonale" placeholder="Es: Sviluppatore Full Stack">
                            </div>
                            <div class="form-group">
                                <label>Descrizione</label>
                                <textarea id="descrizionePersonale" placeholder="Descrivi la posizione..." style="min-height: 80px;"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Retribuzione</label>
                                <input type="text" id="retribuzionePersonale" placeholder="Es: €45-55K/anno">
                            </div>
                            <div class="foto-upload-container">
                                <label for="fotoPersonale">📸 AGGIUNGI FOTO AL TUO ANNUNCIO</label>
                                <input type="file" id="fotoPersonale" accept="image/*" onchange="previewFoto(this, 'previewPersonale')">
                                <div id="previewPersonale"></div>
                                <p style="font-size: 12px; color: #666; margin-top: 10px;">Formati supportati: JPG, PNG, GIF - Max 5MB</p>
                            </div>
                            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                                <button class="action-btn blue" onclick="pubblicaAnnuncioPersonale()">✅ Pubblica</button>
                                <button class="action-btn red" onclick="toggleForm('formPersonale')">❌ Annulla</button>
                            </div>
                        </div>
                    </div>

                    <!-- SEZIONE SPAZI CONDIVISI -->
                    <div id="sezioneSpaziCondivisi" class="sezione-bacheca">
                        <div class="filter-bar">
                            <button class="filter-btn active" onclick="filterSpazi('tutti', this)">Tutti</button>
                            <button class="filter-btn" onclick="filterSpazi('uffici', this)">🏢 Uffici</button>
                            <button class="filter-btn" onclick="filterSpazi('coworking', this)">👥 Coworking</button>
                            <button class="filter-btn" onclick="filterSpazi('magazzini', this)">📦 Magazzini</button>
                            <button class="action-btn purple" onclick="toggleForm('formSpazi')">➕ Aggiungi Spazio</button>
                            <button class="action-btn orange" onclick="window.updateDeleteButtons()" style="padding: 8px 15px; font-size: 12px;">
                                🔄 Aggiorna Pulsanti SPAZI
                            </button>
                        </div>

                        <!-- Container annunci Spazi -->
                        <div id="annunciSpaziContainer">
                            <div class="annuncio-card" id="annuncio_esempio_3" data-autore="rossi@rossisrl.it">
                                <div style="display: flex; gap: 15px; align-items: center;">
                                    <div style="width: 100px; height: 80px; background: linear-gradient(135deg, #9b59b6, #8e44ad); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 30px;">🏢</div>
                                    <div style="flex: 1;">
                                        <div style="margin-bottom: 8px;">
                                            <span class="badge purple">UFFICIO</span>
                                            <span class="badge green">150 MQ</span>
                                        </div>
                                        <h4 style="color: #2c3e50; margin-bottom: 5px;">Ufficio Open Space EUR</h4>
                                        <p style="color: #6c757d; font-size: 13px; margin-bottom: 8px;">15 postazioni, 2 sale riunioni, parcheggio</p>
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <span style="color: #9b59b6; font-weight: bold;">€2.500/mese</span>
                                            <span style="color: #95a5a6; font-size: 11px;">Marco Rossi - Disponibile</span>
                                        </div>
                                    </div>
                                    <div style="display: flex; flex-direction: column; gap: 5px;" class="delete-btn-container">
                                        <!-- PULSANTI STATICI PER TEST -->
                                        <button class="action-btn green" style="padding: 6px 12px; font-size: 11px;" onclick="aggiungiFotoAnnuncio('annuncio_esempio_3')" title="Aggiungi foto">📸➕ Foto</button>
                                        <button class="action-btn red" style="padding: 8px 15px; font-size: 12px;" onclick="window.cancellaAnnuncio('annuncio_esempio_3', 'spazi')">🗑️ Cancella</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Form Spazi -->
                        <div id="formSpazi" class="form-section" style="display: none;">
                            <h3 style="color: #9b59b6; margin-bottom: 20px;">🏢 Offri Spazio in Condivisione</h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div class="form-group">
                                    <label>Tipo Spazio</label>
                                    <select id="tipoSpazio">
                                        <option value="UFFICIO">🏢 Ufficio</option>
                                        <option value="COWORKING">👥 Coworking</option>
                                        <option value="MAGAZZINO">📦 Magazzino</option>
                                        <option value="SALA">🏛️ Sala Riunioni</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Metratura</label>
                                    <input type="text" id="metratura" placeholder="Es: 150 MQ">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Titolo</label>
                                <input type="text" id="titoloSpazio" placeholder="Es: Ufficio Open Space EUR">
                            </div>
                            <div class="form-group">
                                <label>Descrizione</label>
                                <textarea id="descrizioneSpazio" placeholder="Descrivi lo spazio..." style="min-height: 80px;"></textarea>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div class="form-group">
                                    <label>Prezzo (€/mese)</label>
                                    <input type="text" id="prezzoSpazio" placeholder="2500/mese">
                                </div>
                                <div class="form-group">
                                    <label>Località</label>
                                    <input type="text" id="localitaSpazio" placeholder="Roma EUR">
                                </div>
                            </div>
                            <div class="foto-upload-container">
                                <label for="fotoSpazio">📸 AGGIUNGI FOTO AL TUO ANNUNCIO</label>
                                <input type="file" id="fotoSpazio" accept="image/*" onchange="previewFoto(this, 'previewSpazio')">
                                <div id="previewSpazio"></div>
                                <p style="font-size: 12px; color: #666; margin-top: 10px;">Formati supportati: JPG, PNG, GIF - Max 5MB</p>
                            </div>
                            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                                <button class="action-btn purple" onclick="pubblicaAnnuncioSpazio()">✅ Pubblica</button>
                                <button class="action-btn red" onclick="toggleForm('formSpazi')">❌ Annulla</button>
                            </div>
                        </div>
                    </div>

                    <!-- SEZIONE COLLABORAZIONI -->
                    <div id="sezioneCollaborazioni" class="sezione-bacheca">
                        <div class="filter-bar">
                            <button class="filter-btn active" onclick="filterCollab('tutti', this)">Tutti</button>
                            <button class="filter-btn" onclick="filterCollab('partnership', this)">🤝 Partnership</button>
                            <button class="filter-btn" onclick="filterCollab('progetti', this)">🚀 Progetti</button>
                            <button class="filter-btn" onclick="filterCollab('fornitori', this)">📦 Fornitori</button>
                            <button class="action-btn orange" onclick="toggleForm('formCollab')">➕ Proponi Collaborazione</button>
                            <button class="action-btn blue" onclick="window.updateDeleteButtons()" style="padding: 8px 15px; font-size: 12px;">
                                🔄 Aggiorna Pulsanti COLLAB
                            </button>
                        </div>

                        <!-- Container annunci Collaborazioni -->
                        <div id="annunciCollabContainer">
                            <div class="annuncio-card" id="annuncio_esempio_4" data-autore="rossi@rossisrl.it">
                                <div style="display: flex; gap: 15px; align-items: center;">
                                    <div style="width: 100px; height: 80px; background: linear-gradient(135deg, #f39c12, #e67e22); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 30px;">🤝</div>
                                    <div style="flex: 1;">
                                        <div style="margin-bottom: 8px;">
                                            <span class="badge orange">PARTNERSHIP</span>
                                            <span class="badge green">MARKETING</span>
                                        </div>
                                        <h4 style="color: #2c3e50; margin-bottom: 5px;">Partner Campagna Marketing</h4>
                                        <p style="color: #6c757d; font-size: 13px; margin-bottom: 8px;">Cerco partner per campagna nazionale food</p>
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <span style="color: #f39c12; font-weight: bold;">Budget: €50K condiviso</span>
                                            <span style="color: #95a5a6; font-size: 11px;">Marco Rossi - 1 giorno fa</span>
                                        </div>
                                    </div>
                                    <div style="display: flex; flex-direction: column; gap: 5px;" class="delete-btn-container">
                                        <!-- PULSANTI STATICI PER TEST -->
                                        <button class="action-btn green" style="padding: 6px 12px; font-size: 11px;" onclick="aggiungiFotoAnnuncio('annuncio_esempio_4')" title="Aggiungi foto">📸➕ Foto</button>
                                        <button class="action-btn red" style="padding: 8px 15px; font-size: 12px;" onclick="window.cancellaAnnuncio('annuncio_esempio_4', 'collab')">🗑️ Cancella</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Form Collaborazioni -->
                        <div id="formCollab" class="form-section" style="display: none;">
                            <h3 style="color: #f39c12; margin-bottom: 20px;">🤝 Proponi Collaborazione</h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div class="form-group">
                                    <label>Tipo Collaborazione</label>
                                    <select id="tipoCollab">
                                        <option value="PARTNERSHIP">🤝 Partnership</option>
                                        <option value="PROGETTO">🚀 Progetto</option>
                                        <option value="GRUPPO ACQUISTO">📦 Gruppo Acquisto</option>
                                        <option value="RETE">🌐 Rete d'Impresa</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Settore</label>
                                    <select id="settoreCollab">
                                        <option value="TECH">💻 Tech</option>
                                        <option value="MARKETING">📊 Marketing</option>
                                        <option value="ENERGIA">⚡ Energia</option>
                                        <option value="SERVIZI">💼 Servizi</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Titolo</label>
                                <input type="text" id="titoloCollab" placeholder="Es: Partner Campagna Marketing">
                            </div>
                            <div class="form-group">
                                <label>Descrizione</label>
                                <textarea id="descrizioneCollab" placeholder="Descrivi la collaborazione..." style="min-height: 80px;"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Budget/Investimento</label>
                                <input type="text" id="budgetCollab" placeholder="Es: €50K condiviso o Equity 20%">
                            </div>
                            <div class="foto-upload-container">
                                <label for="fotoCollab">📸 AGGIUNGI FOTO AL TUO ANNUNCIO</label>
                                <input type="file" id="fotoCollab" accept="image/*" onchange="previewFoto(this, 'previewCollab')">
                                <div id="previewCollab"></div>
                                <p style="font-size: 12px; color: #666; margin-top: 10px;">Formati supportati: JPG, PNG, GIF - Max 5MB</p>
                            </div>
                            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                                <button class="action-btn orange" onclick="pubblicaAnnuncioCollab()">✅ Pubblica</button>
                                <button class="action-btn red" onclick="toggleForm('formCollab')">❌ Annulla</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variabile globale per le foto
        let currentFotoData = {};

        // Funzione per preview foto
        function previewFoto(input, previewId) {
            const preview = document.getElementById(previewId);
            preview.innerHTML = '';
            
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.className = 'foto-preview';
                    img.style.maxWidth = '200px';
                    img.style.maxHeight = '150px';
                    img.style.borderRadius = '8px';
                    img.style.objectFit = 'cover';
                    
                    const removeBtn = document.createElement('button');
                    removeBtn.innerHTML = '❌ Rimuovi';
                    removeBtn.className = 'action-btn red';
                    removeBtn.style.marginTop = '10px';
                    removeBtn.style.padding = '5px 10px';
                    removeBtn.style.fontSize = '12px';
                    removeBtn.onclick = function() {
                        preview.innerHTML = '';
                        input.value = '';
                    };
                    
                    preview.appendChild(img);
                    preview.appendChild(document.createElement('br'));
                    preview.appendChild(removeBtn);
                };
                
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Funzione per aggiungere foto a annuncio esistente
        function aggiungiFotoAnnuncio(annuncioId) {
            console.log('📸 Aggiunta foto annuncio:', annuncioId);
            
            const annuncio = document.getElementById(annuncioId);
            if (!annuncio) {
                showNotification('❌ Annuncio non trovato', 'error');
                return;
            }
            
            const autoreAnnuncio = annuncio.getAttribute('data-autore');
            
            // Verifica permessi
            if (!currentUser) {
                showNotification('⚠️ Devi essere loggato', 'warning');
                return;
            }
            
            const puo_aggiungere = (currentUser.email === autoreAnnuncio) || (currentUser.role === 'admin');
            if (!puo_aggiungere) {
                showNotification('⚠️ Puoi aggiungere foto solo ai tuoi annunci', 'warning');
                return;
            }
            
            // Crea input file temporaneo
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = 'image/*';
            fileInput.style.display = 'none';
            
            fileInput.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        // Trova il contenitore dell'icona e sostituiscilo con la foto
                        const iconContainer = annuncio.querySelector('div[style*="width: 100px"][style*="height: 80px"]');
                        if (iconContainer) {
                            const fotoContainer = document.createElement('div');
                            fotoContainer.className = 'annuncio-foto-container';
                            fotoContainer.innerHTML = `
                                <img src="${event.target.result}" alt="Foto annuncio" class="annuncio-foto">
                                <button class="remove-foto-btn" onclick="rimuoviFotoAnnuncio('${annuncioId}')" title="Rimuovi foto">❌</button>
                            `;
                            
                            iconContainer.parentNode.replaceChild(fotoContainer, iconContainer);
                            
                            // Aggiorna i pulsanti per mostrare "Rimuovi foto" invece di "Aggiungi foto"
                            setTimeout(() => {
                                window.updateDeleteButtons();
                            }, 100);
                            
                            showNotification('📸 Foto aggiunta con successo!', 'success');
                        }
                    };
                    reader.readAsDataURL(file);
                }
                
                // Rimuovi l'input temporaneo
                document.body.removeChild(fileInput);
            };
            
            // Aggiungi al DOM e clicca
            document.body.appendChild(fileInput);
            fileInput.click();
        }
            console.log('🗑️ Rimozione foto annuncio:', annuncioId);
            
            const annuncio = document.getElementById(annuncioId);
            if (!annuncio) {
                showNotification('❌ Annuncio non trovato', 'error');
                return;
            }
            
            const autoreAnnuncio = annuncio.getAttribute('data-autore');
            
            // Verifica permessi (stesso del cancella annuncio)
            if (!currentUser) {
                showNotification('⚠️ Devi essere loggato', 'warning');
                return;
            }
            
            const puo_rimuovere = (currentUser.email === autoreAnnuncio) || (currentUser.role === 'admin');
            if (!puo_rimuovere) {
                showNotification('⚠️ Puoi rimuovere solo le tue foto', 'warning');
                return;
            }
            
            const fotoContainer = annuncio.querySelector('.annuncio-foto-container');
            if (fotoContainer) {
                fotoContainer.style.transition = 'all 0.3s ease';
                fotoContainer.style.opacity = '0';
                
                setTimeout(() => {
                    // Sostituisci con icona generica
                    const iconContainer = document.createElement('div');
                    iconContainer.style.cssText = `
                        width: 100px; 
                        height: 80px; 
                        background: linear-gradient(135deg, #27ae60, #229954); 
                        border-radius: 10px; 
                        display: flex; 
                        align-items: center; 
                        justify-content: center; 
                        color: white; 
                        font-size: 30px;
                    `;
                    
                    // Determina icona basandosi sul tipo
                    const categoria = annuncio.querySelector('.badge.purple')?.textContent || 
                                    annuncio.querySelector('.badge.blue')?.textContent || 'GENERICO';
                    
                    const icone = {
                        'ATTREZZATURE': '🔧', 'MOBILI': '🪑', 'TECNOLOGIA': '💻', 'VEICOLI': '🚗',
                        'OFFRO LAVORO': '💼', 'CERCO LAVORO': '🔍', 'STAGE': '🎓',
                        'UFFICIO': '🏢', 'COWORKING': '👥', 'MAGAZZINO': '📦', 'SALA': '🏛️',
                        'PARTNERSHIP': '🤝', 'PROGETTO': '🚀', 'GRUPPO ACQUISTO': '📦', 'RETE': '🌐'
                    };
                    
                    iconContainer.innerHTML = icone[categoria] || '📋';
                    
                    fotoContainer.parentNode.replaceChild(iconContainer, fotoContainer);
                    
                    // Aggiorna i pulsanti per mostrare "Aggiungi foto" invece di "Rimuovi foto"
                    setTimeout(() => {
                        window.updateDeleteButtons();
                    }, 100);
                    
                    showNotification('📸 Foto rimossa con successo', 'success');
                }, 300);
            }
        }

        const users = {
            admin: {
                email: 'admin@consorzio.it',
                password: 'admin123',
                role: 'admin',
                name: 'Amministratore Consorzio',
                company: 'Direzione Generale'
            },
            member1: {
                email: 'rossi@rossisrl.it',
                password: 'member123',
                role: 'member',
                name: 'Marco Rossi',
                company: 'Rossi SRL',
                phone: '+39 348 1234567'
            },
            cons1: {
                email: 'maria.bianchi@consorzio.it',
                password: 'cons123',
                role: 'consulente',
                name: 'Dott.ssa Maria Bianchi',
                specializzazione: 'SEO e posizionamento siti',
                phone: '+39 072 1840410'
            }
        };
        
        // Funzione per cancellare annuncio
        window.cancellaAnnuncio = function(annuncioId, tipo) {
            console.log('🗑️ CANCELLAZIONE RICHIESTA:', {
                annuncioId: annuncioId,
                tipo: tipo,
                currentUser: currentUser ? currentUser.email : 'nessuno'
            });
            
            try {
                const annuncio = document.getElementById(annuncioId);
                if (!annuncio) {
                    console.error('❌ Annuncio non trovato nel DOM:', annuncioId);
                    showNotification('❌ Errore: annuncio non trovato', 'error');
                    return;
                }
                
                console.log('✅ Annuncio trovato nel DOM:', annuncio);
                
                // Verifica permessi
                const autoreAnnuncio = annuncio.getAttribute('data-autore');
                console.log('👤 Controllo permessi:', {
                    autoreAnnuncio: autoreAnnuncio,
                    currentUserEmail: currentUser ? currentUser.email : 'nessuno',
                    currentUserRole: currentUser ? currentUser.role : 'nessuno',
                    emailMatch: currentUser ? (currentUser.email === autoreAnnuncio) : false,
                    isAdmin: currentUser ? (currentUser.role === 'admin') : false
                });
                
                if (!currentUser) {
                    console.log('⚠️ Utente non loggato');
                    showNotification('⚠️ Devi essere loggato per cancellare annunci', 'warning');
                    return;
                }
                
                // Solo l'autore o l'admin possono cancellare
                const puo_cancellare = (currentUser.email === autoreAnnuncio) || (currentUser.role === 'admin');
                console.log('🔑 Può cancellare?', puo_cancellare);
                
                if (!puo_cancellare) {
                    console.log('❌ Permessi insufficienti');
                    showNotification('⚠️ Puoi cancellare solo i tuoi annunci', 'warning');
                    return;
                }
                
                console.log('✅ Permessi OK, richiedendo conferma...');
                
                // Conferma con debug
                const conferma = confirm('Sei sicuro di voler cancellare questo annuncio?');
                console.log('❓ Risposta conferma:', conferma);
                
                if (!conferma) {
                    console.log('❌ Cancellazione ANNULLATA dall\'utente (ha cliccato Annulla)');
                    return;
                }
                
                console.log('✅ Conferma RICEVUTA, procedendo con la cancellazione...');
                
                // Animazione fade out
                annuncio.style.transition = 'all 0.5s ease';
                annuncio.style.opacity = '0';
                annuncio.style.transform = 'translateX(-100%)';
                
                setTimeout(() => {
                    console.log('🗑️ Rimuovendo annuncio dal DOM...');
                    annuncio.remove();
                    console.log('✅ Annuncio rimosso dal DOM');
                    
                    // Aggiorna contatore
                    let counter;
                    if (tipo === 'vendita') {
                        counter = document.getElementById('countVendita');
                    } else if (tipo === 'personale') {
                        counter = document.getElementById('countPersonale');
                    } else if (tipo === 'spazi') {
                        counter = document.getElementById('countSpazi');
                    } else if (tipo === 'collab') {
                        counter = document.getElementById('countCollab');
                    }
                    
                    if (counter) {
                        const currentCount = parseInt(counter.innerText);
                        const newCount = Math.max(0, currentCount - 1);
                        counter.innerText = newCount;
                        console.log('📊 Contatore aggiornato:', {
                            tipo: tipo,
                            oldValue: currentCount,
                            newValue: newCount
                        });
                    } else {
                        console.log('⚠️ Counter non trovato per tipo:', tipo);
                    }
                    
                    showNotification('🗑️ Annuncio cancellato con successo', 'success');
                }, 500);
                
            } catch (error) {
                console.error('💥 ERRORE durante la cancellazione:', error);
                showNotification('❌ Errore durante la cancellazione', 'error');
            }
        }
        
        // Funzione per aggiornare la visibilità dei pulsanti cancella
        window.updateDeleteButtons = function() {
            console.log('🔄 ========== AGGIORNAMENTO PULSANTI CANCELLA ==========');
            console.log('Current user:', currentUser ? currentUser.email : 'nessuno');
            
            // Controlla quale sezione è attiva
            const sezioneVendita = document.getElementById('sezioneVendoCompro');
            const sezionePersonale = document.getElementById('sezioneRicercaPersonale');
            const sezioneSpazi = document.getElementById('sezioneSpaziCondivisi');
            const sezioneCollab = document.getElementById('sezioneCollaborazioni');
            
            console.log('📋 Visibilità sezioni:', {
                vendita: sezioneVendita ? (sezioneVendita.style.display !== 'none') : 'non trovata',
                personale: sezionePersonale ? (sezionePersonale.style.display !== 'none') : 'non trovata',
                spazi: sezioneSpazi ? (sezioneSpazi.style.display !== 'none') : 'non trovata',
                collab: sezioneCollab ? (sezioneCollab.style.display !== 'none') : 'non trovata'
            });
            
            const allAnnunci = document.querySelectorAll('.annuncio-card');
            console.log('📋 Annunci trovati totali:', allAnnunci.length);
            
            // Controlla annunci per sezione
            const annunciVendita = document.querySelectorAll('#annunciVenditaContainer .annuncio-card');
            const annunciPersonale = document.querySelectorAll('#annunciPersonaleContainer .annuncio-card');
            const annunciSpazi = document.querySelectorAll('#annunciSpaziContainer .annuncio-card');
            const annunciCollabor = document.querySelectorAll('#annunciCollabContainer .annuncio-card');
            
            console.log('📊 Annunci per sezione:', {
                vendita: annunciVendita.length,
                personale: annunciPersonale.length,
                spazi: annunciSpazi.length,
                collaborazioni: annunciCollabor.length
            });
            
            allAnnunci.forEach((annuncio, index) => {
                const autoreAnnuncio = annuncio.getAttribute('data-autore');
                const deleteContainer = annuncio.querySelector('.delete-btn-container');
                const parentContainer = annuncio.parentElement;
                
                console.log(`📌 Annuncio ${index + 1}:`, {
                    id: annuncio.id,
                    autore: autoreAnnuncio,
                    containerPresente: !!deleteContainer,
                    parentId: parentContainer ? parentContainer.id : 'nessuno',
                    visibile: annuncio.offsetParent !== null
                });
                
                if (deleteContainer) {
                    // Pulisci il container
                    deleteContainer.innerHTML = '';
                    
                    // Mostra il pulsante solo se l'utente può cancellare
                    if (currentUser) {
                        const puo_cancellare = currentUser.email === autoreAnnuncio || currentUser.role === 'admin';
                        console.log(`🔑 Può cancellare ${annuncio.id}:`, puo_cancellare, {
                            userEmail: currentUser.email,
                            autoreEmail: autoreAnnuncio,
                            isAdmin: currentUser.role === 'admin'
                        });
                        
                        if (puo_cancellare) {
                            // Determina il tipo basandosi sul container padre
                            let tipo = 'vendita'; // default
                            
                            if (parentContainer) {
                                if (parentContainer.id === 'annunciVenditaContainer') {
                                    tipo = 'vendita';
                                } else if (parentContainer.id === 'annunciPersonaleContainer') {
                                    tipo = 'personale';
                                } else if (parentContainer.id === 'annunciSpaziContainer') {
                                    tipo = 'spazi';
                                } else if (parentContainer.id === 'annunciCollabContainer') {
                                    tipo = 'collab';
                                }
                            }
                            
                            console.log(`✅ Aggiungendo pulsanti per ${annuncio.id} (tipo: ${tipo})`);
                            
                            // Controlla se ha già una foto
                            const hasFoto = annuncio.querySelector('.annuncio-foto');
                            const hasIcon = annuncio.querySelector('div[style*="width: 100px"][style*="height: 80px"]');
                            
                            let fotoPulsanti = '';
                            if (hasFoto) {
                                // Ha già una foto, mostra solo rimuovi
                                fotoPulsanti = `<button class="action-btn blue" style="padding: 6px 12px; font-size: 11px; margin-bottom: 5px;" onclick="rimuoviFotoAnnuncio('${annuncio.id}')" title="Rimuovi foto">📸❌</button>`;
                            } else if (hasIcon) {
                                // Ha solo icona, mostra aggiungi foto
                                fotoPulsanti = `<button class="action-btn green" style="padding: 6px 12px; font-size: 11px; margin-bottom: 5px;" onclick="aggiungiFotoAnnuncio('${annuncio.id}')" title="Aggiungi foto">📸➕</button>`;
                            }
                            
                            deleteContainer.innerHTML = `
                                ${fotoPulsanti}
                                <button class="action-btn red" style="padding: 8px 15px; font-size: 12px;" 
                                        onclick="window.cancellaAnnuncio('${annuncio.id}', '${tipo}')">
                                    🗑️ Cancella
                                </button>
                            `;
                        }
                    }
                } else {
                    console.log(`❌ Container delete-btn-container mancante per ${annuncio.id}`);
                }
            });
            
            console.log('✅ ========== AGGIORNAMENTO COMPLETATO ==========');
        }

        // Funzioni di navigazione
        function switchLoginTab(tab) {
            document.querySelectorAll('.login-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.login-form').forEach(f => f.classList.remove('active'));
            
            document.querySelector(`.login-tab.${tab}`).classList.add('active');
            document.querySelector(`#${tab}Form`).classList.add('active');
        }

        function login(role) {
            const email = document.getElementById(`${role}Email`).value;
            const password = document.getElementById(`${role}Password`).value;
            
            const user = Object.values(users).find(u => u.email === email && u.password === password && u.role === role);
            
            if (user) {
                currentUser = user;
                console.log('🔑 Login effettuato:', currentUser);
                
                if (role === 'admin') {
                    document.getElementById('admin-dashboard').checked = true;
                } else if (role === 'member') {
                    document.getElementById('member-dashboard').checked = true;
                } else if (role === 'consulente') {
                    document.getElementById('consulente-dashboard').checked = true;
                }
                
                updateUserInfo();
                
                // Aggiorna immediatamente i pulsanti
                console.log('🔄 Chiamando updateDeleteButtons dopo login...');
                setTimeout(() => {
                    window.updateDeleteButtons();
                }, 500);
                
                showNotification(`✅ Accesso effettuato come ${user.name}`, 'success');
            } else {
                showNotification('❌ Credenziali non valide', 'error');
            }
        }

        function logout() {
            currentUser = null;
            document.getElementById('login').checked = true;
            window.updateDeleteButtons(); // Aggiorna i pulsanti cancella
            showNotification('👋 Disconnesso con successo', 'success');
        }

        function tornaAlDashboard() {
            if (currentUser) {
                if (currentUser.role === 'admin') {
                    document.getElementById('admin-dashboard').checked = true;
                } else if (currentUser.role === 'member') {
                    document.getElementById('member-dashboard').checked = true;
                } else if (currentUser.role === 'consulente') {
                    document.getElementById('consulente-dashboard').checked = true;
                }
            } else {
                document.getElementById('login').checked = true;
            }
        }

        // Funzione che viene chiamata quando si entra nella bacheca
        function entraNellaBacheca() {
            console.log('📌 Entrato nella bacheca!');
            setTimeout(() => {
                console.log('🔄 Aggiornando pulsanti dalla bacheca...');
                window.updateDeleteButtons();
                
                // Aggiornamento periodico per essere sicuri
                setTimeout(() => {
                    console.log('🔄 Secondo aggiornamento pulsanti...');
                    window.updateDeleteButtons();
                }, 1000);
                
                setTimeout(() => {
                    console.log('🔄 Terzo aggiornamento pulsanti...');
                    window.updateDeleteButtons();
                }, 2000);
            }, 300);
        }

        // Funzione per aggiornare pulsanti automaticamente
        function aggiornamentoPeriodico() {
            if (currentUser && document.getElementById('bachecaPage').style.display !== 'none') {
                console.log('🔄 Aggiornamento automatico pulsanti...');
                window.updateDeleteButtons();
            }
        }

        // Funzione di test per le foto
        function testFotoFunctions() {
            console.log('📸 TEST FUNZIONI FOTO');
            
            if (!currentUser) {
                showNotification('⚠️ Devi essere loggato per testare le foto', 'warning');
                return;
            }
            
            const allAnnunci = document.querySelectorAll('.annuncio-card');
            console.log('📋 Annunci trovati per test foto:', allAnnunci.length);
            
            allAnnunci.forEach(annuncio => {
                const autore = annuncio.getAttribute('data-autore');
                const hasFoto = annuncio.querySelector('.annuncio-foto');
                const hasIcon = annuncio.querySelector('div[style*="width: 100px"][style*="height: 80px"]');
                
                console.log(`📌 ${annuncio.id}:`, {
                    autore: autore,
                    puo_modificare: (currentUser.email === autore || currentUser.role === 'admin'),
                    hasFoto: !!hasFoto,
                    hasIcon: !!hasIcon
                });
            });
            
            showNotification('📸 Test foto completato - controlla console', 'info');
        }

        // Funzione per forzare l'aggiunta dei pulsanti foto a tutti gli annunci
        function aggiungiCampoFotoATutti() {
            console.log('🎯 FORZANDO AGGIUNTA PULSANTI FOTO...');
            
            if (!currentUser) {
                showNotification('⚠️ Devi essere loggato', 'warning');
                return;
            }
            
            const allAnnunci = document.querySelectorAll('.annuncio-card');
            console.log('📋 Annunci trovati:', allAnnunci.length);
            
            allAnnunci.forEach(annuncio => {
                const autore = annuncio.getAttribute('data-autore');
                const deleteContainer = annuncio.querySelector('.delete-btn-container');
                
                if (deleteContainer && (currentUser.email === autore || currentUser.role === 'admin')) {
                    const hasFoto = annuncio.querySelector('.annuncio-foto');
                    
                    console.log(`🎯 Forzando pulsanti per ${annuncio.id}, hasFoto: ${!!hasFoto}`);
                    
                    if (hasFoto) {
                        // Ha foto - mostra rimuovi
                        deleteContainer.innerHTML = `
                            <button class="action-btn blue" style="padding: 8px 12px; font-size: 12px; margin-bottom: 5px;" onclick="rimuoviFotoAnnuncio('${annuncio.id}')" title="Rimuovi foto">📸❌ Rimuovi</button>
                            <button class="action-btn red" style="padding: 8px 15px; font-size: 12px;" onclick="window.cancellaAnnuncio('${annuncio.id}', 'vendita')">🗑️ Cancella</button>
                        `;
                    } else {
                        // Non ha foto - mostra aggiungi
                        deleteContainer.innerHTML = `
                            <button class="action-btn green" style="padding: 8px 12px; font-size: 12px; margin-bottom: 5px;" onclick="aggiungiFotoAnnuncio('${annuncio.id}')" title="Aggiungi foto">📸➕ Aggiungi</button>
                            <button class="action-btn red" style="padding: 8px 15px; font-size: 12px;" onclick="window.cancellaAnnuncio('${annuncio.id}', 'vendita')">🗑️ Cancella</button>
                        `;
                    }
                }
            });
            
            showNotification('🎯 Pulsanti foto forzati su tutti gli annunci!', 'success');
        }

        function updateUserInfo() {
            const userInfoElements = document.querySelectorAll('.user-info');
            userInfoElements.forEach(el => {
                const roleText = currentUser.role === 'admin' ? 'Admin' : 
                               currentUser.role === 'member' ? 'Membro' : 'Consulente';
                el.innerHTML = `👤 ${currentUser.name} (${roleText})`;
            });
        }

        // Funzioni Tab Bacheca
        function switchTab(tab, btnElement) {
            console.log('🔄 Switching to tab:', tab);
            
            // Se btnElement non è passato, usa event.target
            const clickedBtn = btnElement || (window.event ? window.event.target : null);
            
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.sezione-bacheca').forEach(section => {
                section.classList.remove('active');
                section.style.display = 'none';
            });
            
            if (clickedBtn) {
                clickedBtn.classList.add('active');
            }
            
            let sectionToShow = null;
            if (tab === 'vendoCompro') {
                sectionToShow = document.getElementById('sezioneVendoCompro');
            } else if (tab === 'ricercaPersonale') {
                sectionToShow = document.getElementById('sezioneRicercaPersonale');
            } else if (tab === 'spaziCondivisi') {
                sectionToShow = document.getElementById('sezioneSpaziCondivisi');
            } else if (tab === 'collaborazioni') {
                sectionToShow = document.getElementById('sezioneCollaborazioni');
            }
            
            if (sectionToShow) {
                sectionToShow.classList.add('active');
                sectionToShow.style.display = 'block';
                console.log('✅ Sezione attivata:', sectionToShow.id);
                
                // IMPORTANTE: Aggiorna i pulsanti cancella quando si cambia tab
                setTimeout(() => {
                    console.log('🔄 Aggiornando pulsanti cancella per la nuova sezione...');
                    window.updateDeleteButtons();
                }, 200);
            }
        }

        // Funzioni Form Toggle
        function toggleForm(formId) {
            const form = document.getElementById(formId);
            if (!form) {
                console.error('Form non trovato:', formId);
                showNotification('❌ Errore: form non trovato', 'error');
                return;
            }
            
            if (form.style.display === 'none' || form.style.display === '') {
                form.style.display = 'block';
                form.scrollIntoView({ behavior: 'smooth', block: 'center' });
                showNotification('📝 Compila il form sottostante', 'info');
            } else {
                form.style.display = 'none';
                
                // Reset completo del form
                form.querySelectorAll('input, textarea, select').forEach(field => {
                    if (field.type !== 'button' && field.type !== 'submit') {
                        field.value = field.tagName === 'SELECT' ? field.options[0].value : '';
                    }
                });
                
                // Reset preview foto
                const previewContainers = form.querySelectorAll('[id*="preview"]');
                previewContainers.forEach(container => {
                    container.innerHTML = '';
                });
                
                // Reset input file
                const fileInputs = form.querySelectorAll('input[type="file"]');
                fileInputs.forEach(input => {
                    input.value = '';
                });
            }
        }

        // Funzioni Pubblicazione Annunci
        function pubblicaAnnuncioVendita() {
            if (!currentUser) {
                showNotification('⚠️ Devi essere loggato per pubblicare', 'warning');
                return;
            }
            
            const tipo = document.getElementById('tipoAnnuncioVendita').value;
            const categoria = document.getElementById('categoriaVendita').value;
            const titolo = document.getElementById('titoloVendita').value;
            const descrizione = document.getElementById('descrizioneVendita').value;
            const prezzo = document.getElementById('prezzoVendita').value;
            const fotoInput = document.getElementById('fotoVendita');
            
            if (!titolo || !descrizione || !prezzo) {
                showNotification('⚠️ Compila tutti i campi!', 'warning');
                return;
            }
            
            const container = document.getElementById('annunciVenditaContainer');
            const nuovoAnnuncio = document.createElement('div');
            const annuncioId = 'annuncio_' + (++annuncioIdCounter);
            nuovoAnnuncio.id = annuncioId;
            nuovoAnnuncio.className = 'annuncio-card';
            nuovoAnnuncio.setAttribute('data-autore', currentUser.email);
            
            const colori = {
                'VENDO': 'linear-gradient(135deg, #27ae60, #229954)',
                'COMPRO': 'linear-gradient(135deg, #e74c3c, #c0392b)', 
                'SCAMBIO': 'linear-gradient(135deg, #3498db, #2980b9)'
            };
            
            const badgeColors = {
                'VENDO': 'green',
                'COMPRO': 'red',
                'SCAMBIO': 'blue'
            };
            
            const icone = {
                'ATTREZZATURE': '🔧',
                'MOBILI': '🪑',
                'TECNOLOGIA': '💻',
                'VEICOLI': '🚗'
            };
            
            // Gestione foto
            let fotoHtml = '';
            if (fotoInput.files && fotoInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const fotoSrc = e.target.result;
                    
                    fotoHtml = `
                        <div class="annuncio-foto-container">
                            <img src="${fotoSrc}" alt="${titolo}" class="annuncio-foto">
                            <button class="remove-foto-btn" onclick="rimuoviFotoAnnuncio('${annuncioId}')" title="Rimuovi foto">❌</button>
                        </div>
                    `;
                    
                    aggiungiAnnuncioVendita();
                };
                reader.readAsDataURL(fotoInput.files[0]);
            } else {
                fotoHtml = `<div style="width: 100px; height: 80px; background: ${colori[tipo]}; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 30px;">${icone[categoria]}</div>`;
                aggiungiAnnuncioVendita();
            }
            
            function aggiungiAnnuncioVendita() {
                nuovoAnnuncio.innerHTML = `
                    <div style="display: flex; gap: 15px; align-items: center;">
                        ${fotoHtml}
                        <div style="flex: 1;">
                            <div style="margin-bottom: 8px;">
                                <span class="badge ${badgeColors[tipo]}">${tipo}</span>
                                <span class="badge purple">${categoria}</span>
                                <span class="badge orange">NUOVO</span>
                            </div>
                            <h4 style="color: #2c3e50; margin-bottom: 5px;">${titolo}</h4>
                            <p style="color: #6c757d; font-size: 13px; margin-bottom: 8px;">${descrizione}</p>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="color: ${tipo === 'COMPRO' ? '#e74c3c' : tipo === 'SCAMBIO' ? '#3498db' : '#27ae60'}; font-weight: bold; font-size: 20px;">${tipo === 'SCAMBIO' ? prezzo : '€' + prezzo}</span>
                                <span style="color: #95a5a6; font-size: 11px;">${currentUser.name} - Adesso</span>
                            </div>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 5px;" class="delete-btn-container">
                            <button class="action-btn red" style="padding: 8px 15px; font-size: 12px;" onclick="window.cancellaAnnuncio('${annuncioId}', 'vendita')">🗑️ Cancella</button>
                        </div>
                    </div>
                `;
                
                container.insertBefore(nuovoAnnuncio, container.firstChild);
                
                const counter = document.getElementById('countVendita');
                counter.innerText = parseInt(counter.innerText) + 1;
                
                // Reset form
                document.getElementById('titoloVendita').value = '';
                document.getElementById('descrizioneVendita').value = '';
                document.getElementById('prezzoVendita').value = '';
                document.getElementById('fotoVendita').value = '';
                document.getElementById('previewVendita').innerHTML = '';
                
                toggleForm('formVendoCompro');
                showNotification(`✅ Annuncio "${titolo}" pubblicato con successo!`, 'success');
            }
        }
        
        function pubblicaAnnuncioPersonale() {
            if (!currentUser) {
                showNotification('⚠️ Devi essere loggato per pubblicare', 'warning');
                return;
            }
            
            const tipo = document.getElementById('tipoPersonale').value;
            const contratto = document.getElementById('contrattoPersonale').value;
            const posizione = document.getElementById('posizionePersonale').value;
            const descrizione = document.getElementById('descrizionePersonale').value;
            const retribuzione = document.getElementById('retribuzionePersonale').value;
            const fotoInput = document.getElementById('fotoPersonale');
            
            if (!posizione || !descrizione || !retribuzione) {
                showNotification('⚠️ Compila tutti i campi!', 'warning');
                return;
            }
            
            const container = document.getElementById('annunciPersonaleContainer');
            const nuovoAnnuncio = document.createElement('div');
            const annuncioId = 'annuncio_' + (++annuncioIdCounter);
            nuovoAnnuncio.id = annuncioId;
            nuovoAnnuncio.className = 'annuncio-card';
            nuovoAnnuncio.setAttribute('data-autore', currentUser.email);
            
            const colori = {
                'OFFRO LAVORO': 'linear-gradient(135deg, #3498db, #2980b9)',
                'CERCO LAVORO': 'linear-gradient(135deg, #27ae60, #229954)',
                'STAGE': 'linear-gradient(135deg, #f39c12, #e67e22)'
            };
            
            const icone = {
                'OFFRO LAVORO': '💼',
                'CERCO LAVORO': '🔍',
                'STAGE': '🎓'
            };
            
            // Gestione foto
            let fotoHtml = '';
            if (fotoInput.files && fotoInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    fotoHtml = `
                        <div class="annuncio-foto-container">
                            <img src="${e.target.result}" alt="${posizione}" class="annuncio-foto">
                            <button class="remove-foto-btn" onclick="rimuoviFotoAnnuncio('${annuncioId}')" title="Rimuovi foto">❌</button>
                        </div>
                    `;
                    aggiungiAnnuncioPersonale();
                };
                reader.readAsDataURL(fotoInput.files[0]);
            } else {
                fotoHtml = `<div style="width: 100px; height: 80px; background: ${colori[tipo]}; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 30px;">${icone[tipo]}</div>`;
                aggiungiAnnuncioPersonale();
            }
            
            function aggiungiAnnuncioPersonale() {
                nuovoAnnuncio.innerHTML = `
                    <div style="display: flex; gap: 15px; align-items: center;">
                        ${fotoHtml}
                        <div style="flex: 1;">
                            <div style="margin-bottom: 8px;">
                                <span class="badge blue">${tipo}</span>
                                <span class="badge green">${contratto}</span>
                                <span class="badge orange">NUOVO</span>
                            </div>
                            <h4 style="color: #2c3e50; margin-bottom: 5px;">${posizione}</h4>
                            <p style="color: #6c757d; font-size: 13px; margin-bottom: 8px;">${descrizione}</p>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="color: #3498db; font-weight: bold;">${retribuzione}</span>
                                <span style="color: #95a5a6; font-size: 11px;">${currentUser.company || currentUser.name} - Adesso</span>
                            </div>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 5px;" class="delete-btn-container">
                            <button class="action-btn red" style="padding: 8px 15px; font-size: 12px;" onclick="window.cancellaAnnuncio('${annuncioId}', 'personale')">🗑️ Cancella</button>
                        </div>
                    </div>
                `;
                
                container.insertBefore(nuovoAnnuncio, container.firstChild);
                
                const counter = document.getElementById('countPersonale');
                counter.innerText = parseInt(counter.innerText) + 1;
                
                // Reset form
                document.getElementById('posizionePersonale').value = '';
                document.getElementById('descrizionePersonale').value = '';
                document.getElementById('retribuzionePersonale').value = '';
                document.getElementById('fotoPersonale').value = '';
                document.getElementById('previewPersonale').innerHTML = '';
                
                toggleForm('formPersonale');
                showNotification(`✅ Offerta "${posizione}" pubblicata!`, 'success');
            }
        }
        
        function pubblicaAnnuncioSpazio() {
            if (!currentUser) {
                showNotification('⚠️ Devi essere loggato per pubblicare', 'warning');
                return;
            }
            
            const tipo = document.getElementById('tipoSpazio').value;
            const metratura = document.getElementById('metratura').value;
            const titolo = document.getElementById('titoloSpazio').value;
            const descrizione = document.getElementById('descrizioneSpazio').value;
            const prezzo = document.getElementById('prezzoSpazio').value;
            const localita = document.getElementById('localitaSpazio').value;
            const fotoInput = document.getElementById('fotoSpazio');
            
            if (!titolo || !descrizione || !prezzo || !localita) {
                showNotification('⚠️ Compila tutti i campi!', 'warning');
                return;
            }
            
            const container = document.getElementById('annunciSpaziContainer');
            const nuovoAnnuncio = document.createElement('div');
            const annuncioId = 'annuncio_' + (++annuncioIdCounter);
            nuovoAnnuncio.id = annuncioId;
            nuovoAnnuncio.className = 'annuncio-card';
            nuovoAnnuncio.setAttribute('data-autore', currentUser.email);
            
            const colori = {
                'UFFICIO': 'linear-gradient(135deg, #9b59b6, #8e44ad)',
                'COWORKING': 'linear-gradient(135deg, #3498db, #2980b9)',
                'MAGAZZINO': 'linear-gradient(135deg, #e67e22, #d35400)',
                'SALA': 'linear-gradient(135deg, #27ae60, #229954)'
            };
            
            const icone = {
                'UFFICIO': '🏢',
                'COWORKING': '👥',
                'MAGAZZINO': '📦',
                'SALA': '🏛️'
            };
            
            // Gestione foto
            let fotoHtml = '';
            if (fotoInput.files && fotoInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    fotoHtml = `
                        <div class="annuncio-foto-container">
                            <img src="${e.target.result}" alt="${titolo}" class="annuncio-foto">
                            <button class="remove-foto-btn" onclick="rimuoviFotoAnnuncio('${annuncioId}')" title="Rimuovi foto">❌</button>
                        </div>
                    `;
                    aggiungiAnnuncioSpazio();
                };
                reader.readAsDataURL(fotoInput.files[0]);
            } else {
                fotoHtml = `<div style="width: 100px; height: 80px; background: ${colori[tipo]}; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 30px;">${icone[tipo]}</div>`;
                aggiungiAnnuncioSpazio();
            }
            
            function aggiungiAnnuncioSpazio() {
                nuovoAnnuncio.innerHTML = `
                    <div style="display: flex; gap: 15px; align-items: center;">
                        ${fotoHtml}
                        <div style="flex: 1;">
                            <div style="margin-bottom: 8px;">
                                <span class="badge purple">${tipo}</span>
                                <span class="badge green">${metratura}</span>
                                <span class="badge orange">NUOVO</span>
                            </div>
                            <h4 style="color: #2c3e50; margin-bottom: 5px;">${titolo}</h4>
                            <p style="color: #6c757d; font-size: 13px; margin-bottom: 8px;">${descrizione}</p>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="color: #9b59b6; font-weight: bold;">€${prezzo}</span>
                                <span style="color: #95a5a6; font-size: 11px;">${localita} - Disponibile</span>
                            </div>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 5px;" class="delete-btn-container">
                            <button class="action-btn red" style="padding: 8px 15px; font-size: 12px;" onclick="window.cancellaAnnuncio('${annuncioId}', 'spazi')">🗑️ Cancella</button>
                        </div>
                    </div>
                `;
                
                container.insertBefore(nuovoAnnuncio, container.firstChild);
                
                const counter = document.getElementById('countSpazi');
                counter.innerText = parseInt(counter.innerText) + 1;
                
                // Reset form
                document.getElementById('titoloSpazio').value = '';
                document.getElementById('descrizioneSpazio').value = '';
                document.getElementById('prezzoSpazio').value = '';
                document.getElementById('metratura').value = '';
                document.getElementById('localitaSpazio').value = '';
                document.getElementById('fotoSpazio').value = '';
                document.getElementById('previewSpazio').innerHTML = '';
                
                toggleForm('formSpazi');
                showNotification(`✅ Spazio "${titolo}" pubblicato!`, 'success');
            }
        }
        
        function pubblicaAnnuncioCollab() {
            if (!currentUser) {
                showNotification('⚠️ Devi essere loggato per pubblicare', 'warning');
                return;
            }
            
            const tipo = document.getElementById('tipoCollab').value;
            const settore = document.getElementById('settoreCollab').value;
            const titolo = document.getElementById('titoloCollab').value;
            const descrizione = document.getElementById('descrizioneCollab').value;
            const budget = document.getElementById('budgetCollab').value;
            const fotoInput = document.getElementById('fotoCollab');
            
            if (!titolo || !descrizione || !budget) {
                showNotification('⚠️ Compila tutti i campi!', 'warning');
                return;
            }
            
            const container = document.getElementById('annunciCollabContainer');
            const nuovoAnnuncio = document.createElement('div');
            const annuncioId = 'annuncio_' + (++annuncioIdCounter);
            nuovoAnnuncio.id = annuncioId;
            nuovoAnnuncio.className = 'annuncio-card';
            nuovoAnnuncio.setAttribute('data-autore', currentUser.email);
            
            const colori = {
                'PARTNERSHIP': 'linear-gradient(135deg, #f39c12, #e67e22)',
                'PROGETTO': 'linear-gradient(135deg, #27ae60, #229954)',
                'GRUPPO ACQUISTO': 'linear-gradient(135deg, #e74c3c, #c0392b)',
                'RETE': 'linear-gradient(135deg, #3498db, #2980b9)'
            };
            
            const icone = {
                'PARTNERSHIP': '🤝',
                'PROGETTO': '🚀',
                'GRUPPO ACQUISTO': '📦',
                'RETE': '🌐'
            };
            
            const badgeColors = {
                'PARTNERSHIP': 'orange',
                'PROGETTO': 'green',
                'GRUPPO ACQUISTO': 'red',
                'RETE': 'blue'
            };
            
            // Gestione foto
            let fotoHtml = '';
            if (fotoInput.files && fotoInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    fotoHtml = `
                        <div class="annuncio-foto-container">
                            <img src="${e.target.result}" alt="${titolo}" class="annuncio-foto">
                            <button class="remove-foto-btn" onclick="rimuoviFotoAnnuncio('${annuncioId}')" title="Rimuovi foto">❌</button>
                        </div>
                    `;
                    aggiungiAnnuncioCollab();
                };
                reader.readAsDataURL(fotoInput.files[0]);
            } else {
                fotoHtml = `<div style="width: 100px; height: 80px; background: ${colori[tipo]}; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 30px;">${icone[tipo]}</div>`;
                aggiungiAnnuncioCollab();
            }
            
            function aggiungiAnnuncioCollab() {
                nuovoAnnuncio.innerHTML = `
                    <div style="display: flex; gap: 15px; align-items: center;">
                        ${fotoHtml}
                        <div style="flex: 1;">
                            <div style="margin-bottom: 8px;">
                                <span class="badge ${badgeColors[tipo]}">${tipo}</span>
                                <span class="badge blue">${settore}</span>
                                <span class="badge purple">NUOVO</span>
                            </div>
                            <h4 style="color: #2c3e50; margin-bottom: 5px;">${titolo}</h4>
                            <p style="color: #6c757d; font-size: 13px; margin-bottom: 8px;">${descrizione}</p>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="color: #f39c12; font-weight: bold;">${budget}</span>
                                <span style="color: #95a5a6; font-size: 11px;">${currentUser.company || currentUser.name} - Adesso</span>
                            </div>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 5px;" class="delete-btn-container">
                            <button class="action-btn red" style="padding: 8px 15px; font-size: 12px;" onclick="window.cancellaAnnuncio('${annuncioId}', 'collab')">🗑️ Cancella</button>
                        </div>
                    </div>
                `;
                
                container.insertBefore(nuovoAnnuncio, container.firstChild);
                
                const counter = document.getElementById('countCollab');
                counter.innerText = parseInt(counter.innerText) + 1;
                
                // Reset form
                document.getElementById('titoloCollab').value = '';
                document.getElementById('descrizioneCollab').value = '';
                document.getElementById('budgetCollab').value = '';
                document.getElementById('fotoCollab').value = '';
                document.getElementById('previewCollab').innerHTML = '';
                
                toggleForm('formCollab');
                showNotification(`✅ Collaborazione "${titolo}" pubblicata!`, 'success');
            }
        }

        // Funzioni Filtri Bacheca
        function filterAnnunci(tipo, btn) {
            // Trova solo i filter-btn nel contenitore del bottone cliccato
            const container = btn.closest('.filter-bar');
            if (container) {
                container.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            }
            showNotification(`🔍 Filtro: ${tipo}`, 'info');
        }
        
        function filterPersonale(tipo, btn) {
            const container = btn.closest('.filter-bar');
            if (container) {
                container.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            }
            showNotification(`🔍 Filtro: ${tipo}`, 'info');
        }
        
        function filterSpazi(tipo, btn) {
            const container = btn.closest('.filter-bar');
            if (container) {
                container.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            }
            showNotification(`🔍 Filtro: ${tipo}`, 'info');
        }
        
        function filterCollab(tipo, btn) {
            const container = btn.closest('.filter-bar');
            if (container) {
                container.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            }
            showNotification(`🔍 Filtro: ${tipo}`, 'info');
        }

        // Notifiche
        function showNotification(message, type) {
            const colors = {
                success: '#27ae60',
                error: '#e74c3c',
                warning: '#f39c12',
                info: '#3498db'
            };
            
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed; 
                top: 20px; 
                right: 20px; 
                background: ${colors[type]}; 
                color: white; 
                padding: 15px 20px; 
                border-radius: 10px; 
                z-index: 10000; 
                max-width: 350px;
                font-size: 14px;
                box-shadow: 0 5px 20px rgba(0,0,0,0.3);
                animation: slideIn 0.3s ease;
            `;
            notification.innerHTML = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Inizializzazione
        window.onload = function() {
            console.log('🔄 Inizializzazione sistema...');
            
            // Verifica che tutte le funzioni siano disponibili
            if (typeof window.cancellaAnnuncio !== 'function') {
                console.error('❌ Funzione cancellaAnnuncio non trovata!');
            } else {
                console.log('✅ Funzione cancellaAnnuncio caricata');
            }
            
            switchLoginTab('admin');
            
            // Verifica form
            const forms = ['formVendoCompro', 'formPersonale', 'formSpazi', 'formCollab'];
            forms.forEach(formId => {
                const form = document.getElementById(formId);
                if (form) {
                    form.style.display = 'none';
                    console.log(`✅ Form ${formId} inizializzato`);
                }
            });
            
            // Inizializza prima sezione bacheca
            const primaSezione = document.getElementById('sezioneVendoCompro');
            if (primaSezione) {
                primaSezione.style.display = 'block';
                primaSezione.classList.add('active');
                console.log('✅ Sezione Vendo/Compro attivata');
            }
            
            // Aggiungi animazioni CSS
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(400px); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(400px); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
            
            // Aggiorna i pulsanti cancella all'avvio
            setTimeout(() => {
                console.log('🔄 Primo aggiornamento pulsanti...');
                window.updateDeleteButtons();
            }, 500);
            
            setTimeout(() => {
                console.log('🔄 Secondo aggiornamento pulsanti...');
                window.updateDeleteButtons();
            }, 1500);
            
            // Aggiornamento periodico ogni 3 secondi
            setInterval(() => {
                if (currentUser) {
                    aggiornamentoPeriodico();
                }
            }, 3000);
            
            console.log('✅ Sistema inizializzato correttamente');
        };
    </script>
</body>
</html>
