// DEFINISCI SUBITO TUTTE LE FUNZIONI CRITICHE SU WINDOW PRIMA DI QUALSIASI ALTRA COSA
        
        // Funzione per eliminare annuncio
        window.eliminaAnnuncio = function(id) {
            console.log('Eliminando annuncio con ID:', id);
            if (confirm('Vuoi eliminare questo annuncio?')) {
                annunci = annunci.filter(a => a.id !== id);
                renderAnnunci();
                showToast('âœ… Annuncio eliminato', 'success');
            }
        };

        // Funzione per modificare annuncio
        window.modificaAnnuncio = function(id) {
            console.log('Modificando annuncio con ID:', id);
            toggleAnnuncioForm(id);
        };

        // Funzione per pubblicare annuncio
        window.pubblicaAnnuncio = function() {
            const titolo = document.getElementById('annuncioTitolo').value.trim();
            const descrizione = document.getElementById('annuncioDescrizione').value.trim();
            const prezzo = document.getElementById('annuncioPrezzo').value.trim();
            const categoria = document.getElementById('annuncioCategoria').value;
            
            if (!titolo || !descrizione) {
                showToast('âš ï¸ Compila tutti i campi obbligatori', 'error');
                return;
            }
            
            if (editingAnnuncioId) {
                // ModalitÃ  modifica
                const annuncioIndex = annunci.findIndex(a => a.id === editingAnnuncioId);
                if (annuncioIndex !== -1) {
                    annunci[annuncioIndex] = {
                        ...annunci[annuncioIndex],
                        categoria: categoria,
                        titolo: titolo,
                        descrizione: descrizione,
                        prezzo: prezzo,
                        data: 'modificato ora'
                    };
                    showToast('âœ… Annuncio modificato con successo!', 'success');
                }
                editingAnnuncioId = null;
            } else {
                // ModalitÃ  creazione
                const nuovoAnnuncio = {
                    id: nextAnnuncioId++,
                    categoria: categoria,
                    titolo: titolo,
                    descrizione: descrizione,
                    prezzo: prezzo,
                    autore: 'Tu',
                    autoreRole: currentUser,
                    data: 'ora'
                };
                
                // Add to beginning of array
                annunci.unshift(nuovoAnnuncio);
                showToast('âœ… Annuncio pubblicato con successo!', 'success');
            }
            
            // Update UI
            renderAnnunci();
            toggleAnnuncioForm();
        };

        // Toggle form annuncio
        window.toggleAnnuncioForm = function(annuncioId = null) {
            const form = document.getElementById('annuncioForm');
            
            if (annuncioId) {
                // ModalitÃ  modifica
                editingAnnuncioId = annuncioId;
                const annuncio = annunci.find(a => a.id === annuncioId);
                if (annuncio) {
                    document.getElementById('annuncioTitolo').value = annuncio.titolo;
                    document.getElementById('annuncioDescrizione').value = annuncio.descrizione;
                    const prezzoValue = annuncio.prezzo ? annuncio.prezzo.replace('ðŸ’° ', '').replace('â‚¬', '').trim() : '';
                    document.getElementById('annuncioPrezzo').value = prezzoValue;
                    
                    // Set categoria
                    const options = document.getElementById('annuncioCategoria').options;
                    for (let i = 0; i < options.length; i++) {
                        if (options[i].value === annuncio.categoria) {
                            document.getElementById('annuncioCategoria').selectedIndex = i;
                            break;
                        }
                    }
                    
                    form.classList.add('active');
                }
            } else {
                // Toggle normale
                form.classList.toggle('active');
                
                // Reset form if closing
                if (!form.classList.contains('active')) {
                    editingAnnuncioId = null;
                    document.getElementById('annuncioTitolo').value = '';
                    document.getElementById('annuncioDescrizione').value = '';
                    document.getElementById('annuncioPrezzo').value = '';
                    document.getElementById('annuncioCategoria').selectedIndex = 0;
                }
            }
        };

        console.log('âœ… Funzioni annunci definite correttamente:', {
            eliminaAnnuncio: typeof window.eliminaAnnuncio,
            modificaAnnuncio: typeof window.modificaAnnuncio,
            pubblicaAnnuncio: typeof window.pubblicaAnnuncio,
            toggleAnnuncioForm: typeof window.toggleAnnuncioForm
        });
